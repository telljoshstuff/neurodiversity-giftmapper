<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neurodiversity GiftMapper - Conference Ready</title>
<!-- Firebase -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-database-compat.min.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

.gift-mapper {
font-family: 'Arial', sans-serif;
max-width: 900px;
margin: 0 auto;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
border-radius: 20px;
padding: 30px;
color: white;
min-height: 600px;
}

.step {
display: none;
text-align: center;
}

.step.active {
display: block;
animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

h1 {
font-size: 2.5em;
margin-bottom: 20px;
text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

h2 {
font-size: 1.8em;
margin-bottom: 20px;
color: #fff;
}

.intro-text {
font-size: 1.1em;
line-height: 1.6;
margin-bottom: 30px;
opacity: 0.9;
}

.question-container {
background: rgba(255,255,255,0.1);
border-radius: 15px;
padding: 25px;
margin: 20px 0;
backdrop-filter: blur(10px);
border: 1px solid rgba(255,255,255,0.2);
}

.btn {
background: #ff6b6b;
color: white;
border: none;
padding: 15px 30px;
border-radius: 50px;
font-size: 1.1em;
font-weight: bold;
cursor: pointer;
transition: all 0.3s ease;
margin: 20px 10px;
box-shadow: 0 5px 15px rgba(255,107,107,0.3);
}

.btn:hover {
background: #ee5a52;
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(255,107,107,0.4);
}

.btn:disabled {
background: #ccc;
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.session-code {
font-family: monospace;
font-size: 2em;
font-weight: bold;
color: #ff6b6b;
background: rgba(255,255,255,0.3);
padding: 15px 25px;
border-radius: 15px;
display: inline-block;
margin: 15px 0;
letter-spacing: 3px;
}

input[type="text"] {
background: rgba(255,255,255,0.9);
color: #333;
border: 2px solid transparent;
padding: 12px 15px;
border-radius: 8px;
font-size: 1em;
text-align: center;
margin: 10px;
}

select {
background: rgba(255,255,255,0.9);
color: #333;
border: 2px solid transparent;
padding: 12px 15px;
border-radius: 8px;
font-size: 1em;
margin: 10px;
}

.loading {
text-align: center;
padding: 40px;
}

.loading-spinner {
border: 3px solid rgba(255,255,255,0.3);
border-radius: 50%;
border-top: 3px solid #ff6b6b;
width: 30px;
height: 30px;
animation: spin 1s linear infinite;
margin: 20px auto;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
.gift-mapper {
padding: 20px;
margin: 10px;
}
.btn {
width: 100%;
margin: 10px 0;
}
}
</style>
</head>
<body>
<div class="gift-mapper">
<!-- Welcome Step -->
<div class="step active" id="welcome">
<h1>ðŸŒŸ Neurodiversity GiftMapper</h1>
<div class="intro-text">
<p>Discover your collective genius and unlock entrepreneurial opportunities!</p>
<p><strong>Conference-ready assessment with real-time collaboration mapping</strong></p>
</div>
<button class="btn" onclick="showOptions()">Begin Discovery</button>
</div>

<!-- Options Step -->
<div class="step" id="options">
<h2>Choose Your Session Type</h2>
<div class="question-container">
<button class="btn" onclick="createSession()" style="background: #27ae60; margin: 10px; width: 200px;">
ðŸŽª Host Group Session
</button>
<div style="margin: 20px 0; color: rgba(255,255,255,0.8);">OR</div>
<div style="margin: 20px 0;">
<input type="text" id="join-code" placeholder="Enter Session Code" maxlength="6" style="width: 150px;">
<button class="btn" onclick="joinSession()" style="background: #3498db;">
ðŸš€ Join Session
</button>
</div>
<div style="margin-top: 30px;">
<button class="btn" onclick="startIndividual()" style="background: #9b59b6;">
ðŸ‘¤ Individual Assessment
</button>
</div>
</div>
</div>

<!-- Session Created Step -->
<div class="step" id="session-created">
<h2>ðŸŽ‰ Session Created!</h2>
<div class="question-container">
<div style="margin-bottom: 20px;">Share this code with your participants:</div>
<div class="session-code" id="created-session-code">ABC123</div>
<div style="font-size: 0.9em; opacity: 0.8; margin-top: 15px;">
Others can join by clicking "Join Session" and entering this code
</div>
</div>
<button class="btn" onclick="proceedToAssessment()">Continue to Assessment</button>
<button class="btn" onclick="viewGroupDashboard()" style="background: #9b59b6;">ðŸ‘¥ View Dashboard</button>
</div>

<!-- Name Collection with Hub Selection -->
<div class="step" id="name-step">
<h2>Conference Setup</h2>
<div class="intro-text">
<p>This helps us create your personalized constellation and connect you with your hub!</p>
</div>
<div class="question-container">
<input type="text" id="participant-name" placeholder="Your name or nickname" style="width: 100%; padding: 15px; border-radius: 10px; border: none; font-size: 1.1em; text-align: center; margin-bottom: 20px;">
<div style="margin: 20px 0;">
<label for="hub-number" style="display: block; margin-bottom: 10px; font-weight: bold;">Which conference hub are you in?</label>
<select id="hub-number" style="width: 100%; padding: 15px; border-radius: 10px; border: none; font-size: 1.1em; text-align: center; background: rgba(255,255,255,0.9); color: #333;">
<option value="">Select your hub...</option>
<option value="1">Hub 1</option>
<option value="2">Hub 2</option>
<option value="3">Hub 3</option>
<option value="4">Hub 4</option>
<option value="5">Hub 5</option>
<option value="6">Hub 6</option>
<option value="7">Hub 7</option>
<option value="8">Hub 8</option>
<option value="9">Hub 9</option>
<option value="10">Hub 10</option>
<option value="11">Hub 11</option>
<option value="12">Hub 12</option>
<option value="13">Hub 13</option>
<option value="14">Hub 14</option>
<option value="15">Hub 15</option>
<option value="16">Hub 16</option>
<option value="17">Hub 17</option>
<option value="18">Hub 18</option>
<option value="19">Hub 19</option>
<option value="20">Hub 20</option>
<option value="21">Hub 21</option>
<option value="22">Hub 22</option>
<option value="23">Hub 23</option>
<option value="24">Hub 24</option>
<option value="25">Hub 25</option>
</select>
</div>
</div>
<button class="btn" onclick="startAssessment()" id="name-next" disabled>Continue to Assessment</button>
</div>

<!-- Simple Success Step -->
<div class="step" id="success">
<h2>ðŸŽ‰ Assessment Complete!</h2>
<div class="question-container">
<h3>Your Hub: <span id="user-hub">--</span></h3>
<h3>Your Name: <span id="user-name">--</span></h3>
<p style="margin: 20px 0;">Thank you for participating in the Strength and Sustainability Conference assessment!</p>
<p>Your responses have been saved and you're connected with your hub for collaborative opportunities.</p>
</div>
<button class="btn" onclick="restart()">ðŸ”„ Start Over</button>
</div>

<!-- Loading Step -->
<div class="step" id="loading">
<div class="loading">
<div class="loading-spinner"></div>
<h3 id="loading-message">Processing...</h3>
</div>
</div>
</div>

<script>
// Firebase Configuration
const firebaseConfig = {
apiKey: "AIzaSyCgNBubK8yce1BOZ-opG3WiYtddSvoENME",
authDomain: "neurodiversity-giftmapper.firebaseapp.com",
databaseURL: "https://neurodiversity-giftmapper-default-rtdb.firebaseio.com",
projectId: "neurodiversity-giftmapper",
storageBucket: "neurodiversity-giftmapper.firebasestorage.app",
messagingSenderId: "244274800284",
appId: "1:244274800284:web:41c837df1656759a87af59",
measurementId: "G-ZWLH0C7R76"
};

// Global variables
let database = null;
let firebaseAvailable = false;

// Initialize Firebase
try {
firebase.initializeApp(firebaseConfig);
database = firebase.database();
firebaseAvailable = true;
console.log('âœ… Firebase initialized successfully');
} catch (error) {
console.warn('âš  Firebase initialization failed, using localStorage only:', error);
firebaseAvailable = false;
}

// Global state
let assessmentData = {
participantName: '',
hubNumber: '',
sessionId: null,
isGroupSession: false,
isHost: false
};

// Step navigation functions
function showStep(stepId) {
document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
document.getElementById(stepId).classList.add('active');
}

function showOptions() {
showStep('options');
}

function startIndividual() {
assessmentData.isGroupSession = false;
showStep('name-step');
}

function proceedToAssessment() {
showStep('name-step');
}

// Session management
function generateSessionCode() {
return Math.random().toString(36).substring(2, 8).toUpperCase();
}

async function createSession() {
try {
showStep('loading');
document.getElementById('loading-message').textContent = 'Creating session...';

const sessionCode = generateSessionCode();
assessmentData.sessionId = sessionCode;
assessmentData.isHost = true;
assessmentData.isGroupSession = true;

// Try Firebase first
if (firebaseAvailable && database) {
try {
await database.ref(`sessions/${sessionCode}`).set({
created: Date.now(),
host: true,
participants: {}
});
console.log('âœ… Session created in Firebase:', sessionCode);
} catch (error) {
console.warn('âš  Firebase session creation failed:', error);
}
}

// Always save to localStorage as backup
localStorage.setItem(`session_${sessionCode}`, JSON.stringify({
created: Date.now(),
participants: {}
}));

document.getElementById('created-session-code').textContent = sessionCode;
showStep('session-created');
} catch (error) {
console.error('Session creation error:', error);
alert('Failed to create session. Please try again.');
showStep('options');
}
}

async function joinSession() {
const code = document.getElementById('join-code').value.trim().toUpperCase();
if (!code) return;

try {
showStep('loading');
document.getElementById('loading-message').textContent = 'Joining session...';

// Try Firebase first
let sessionExists = false;
if (firebaseAvailable && database) {
try {
const snapshot = await database.ref(`sessions/${code}`).once('value');
sessionExists = snapshot.exists();
} catch (error) {
console.warn('âš  Firebase session check failed:', error);
}
}

// Fallback to localStorage
if (!sessionExists) {
const sessionData = localStorage.getItem(`session_${code}`);
sessionExists = sessionData !== null;
}

if (sessionExists) {
assessmentData.sessionId = code;
assessmentData.isHost = false;
assessmentData.isGroupSession = true;
showStep('name-step');
} else {
alert('Session not found. Please check the code and try again.');
showStep('options');
}
} catch (error) {
console.error('Join session error:', error);
alert('Failed to join session. Please try again.');
showStep('options');
}
}

function startAssessment() {
const name = document.getElementById('participant-name').value.trim();
const hub = document.getElementById('hub-number').value;
if (!name || !hub) return;

assessmentData.participantName = name;
assessmentData.hubNumber = hub;

// Show success page
document.getElementById('user-name').textContent = name;
document.getElementById('user-hub').textContent = hub;

// Save data if in group session
if (assessmentData.isGroupSession && assessmentData.sessionId) {
saveParticipantData();
}

showStep('success');
}

async function saveParticipantData() {
try {
const participantData = {
name: assessmentData.participantName,
hubNumber: assessmentData.hubNumber,
timestamp: Date.now()
};

// Try Firebase first
if (firebaseAvailable && database && assessmentData.sessionId) {
try {
await database.ref(`sessions/${assessmentData.sessionId}/participants/${assessmentData.participantName}`).set(participantData);
console.log('âœ… Participant data saved to Firebase');
} catch (error) {
console.warn('âš  Firebase save failed:', error);
}
}

// Always save to localStorage as backup
const sessionKey = `session_${assessmentData.sessionId}`;
const sessionData = JSON.parse(localStorage.getItem(sessionKey) || '{"participants": {}}');
sessionData.participants[assessmentData.participantName] = participantData;
localStorage.setItem(sessionKey, JSON.stringify(sessionData));

} catch (error) {
console.error('Error saving participant data:', error);
}
}

function viewGroupDashboard() {
alert('Dashboard feature coming soon! For now, your session is active and participants can join.');
}

function restart() {
// Clear all data
assessmentData = {
participantName: '',
hubNumber: '',
sessionId: null,
isGroupSession: false,
isHost: false
};

// Reset form
document.getElementById('participant-name').value = '';
document.getElementById('hub-number').value = '';
document.getElementById('join-code').value = '';

showStep('welcome');
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
const nameInput = document.getElementById('participant-name');
const hubSelect = document.getElementById('hub-number');

function checkNameAndHub() {
const nameValid = nameInput.value.trim().length > 0;
const hubValid = hubSelect.value !== '';
document.getElementById('name-next').disabled = !(nameValid && hubValid);
}

nameInput.addEventListener('input', checkNameAndHub);
hubSelect.addEventListener('change', checkNameAndHub);
});

console.log('ðŸŒŸ Neurodiversity GiftMapper initialized successfully!');
</script>
</body>
</html>
